<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel='shortcut icon' href='img/favicon.ico' type='image/x-icon'/>

    <title>SnmpCG - Admin Interface</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/vendor/bootstrap.min.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/vendor/html5shiv.js"></script>
      <script src="js/vendor/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="index.html">SnmpCG</a>
        </div>
        <ul class="nav navbar-nav">
          <li><a href="index.html">Sources</a></li>
        </ul>
        <button id="removeBtn" type="button" class="btn btn-default navbar-btn navbar-right" onclick="delSource()">Remove from CG</button>
      </div>
    </nav>
    <!-- page content -->
    <div class="container">
    	<div class="row">
        	<h2>Source details</span></h2>
        </div>
        <div class="row">
        		<table id="tbl" class="table table-condensed">
        			<tbody>
        		</table>
        </div>
        <div class="row">
          <h3>ifTable</h3>
		  <table id="ifTable" class="table table-condensed">
          <thead>
            <tr>
              <th>ifIndex</th>
              <th>ifDescr</th>
              <th>ifName</th>
              <th>ifAlias</th>
              <th>ifAdminStatus</th>
              <th>ifOperStatus</th>
              <th>pollInOctets</th>
              <th>pollOutOctets</th>
            </tr>
          </thead>
          <tbody>
          </tbody>  
        </table>
		</div>
    </div>
    <!-- /.container -->

    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="js/vendor/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/datatables.min.js"></script>
    <!-- script src="js/jquery.dataTables.min.js"></script -->
    <script src="js/dataTables.bootstrap.min.js"></script>
    <script>
        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam) {
                    return sParameterName[1];
                }
            }
        }

    var ip = getUrlParameter("ip");
    
    $("#removeBtn").text("Remove source:"+ip);
    
    function delSource() {
    	$.ajax({
    		url: "/api/v1/sources/"+ip,
    		type: "DELETE",
    		success: function(result) {
    			window.location.href = "index.html";
    		}
		});
    }
    
    function pad(v) {
    	return v<10?"0"+v:v;
    }
    
    function uptime(timeticks) {
    	var tt = timeticks;
    	var d = Math.floor(tt / 8640000);
    	tt %= 8640000;
    	var h = Math.floor(tt / 360000);
    	tt %= 360000;
    	var m = Math.floor(tt / 6000);
    	tt %= 6000;
    	var s= Math.floor( tt / 100);
    	tt %= 100;
    	return d+" days, "+pad(h)+":"+pad(m)+":"+pad(s)+"."+tt; 
    }
    
    $.ajax({
    	url: "/api/v1/sources/"+ip,
    	success: function(source){
            $("#tbl tbody tr").empty();
            //$("#tbl tbody").append("<tr><th>action:</th><td><button type=\"button\" class=\"btn btn-default\" onclick=\"delSource()\"><small>Remove from CG</small></button></td></tr>");
            $("#tbl tbody").append("<tr><th>ipAddress:</th><td><small>" + source.Ip + "</small></td></tr>");
            $("#tbl tbody").append("<tr><th>sysName:</th><td><small>" + source.sysName + "</small></td></tr>");
            $("#tbl tbody").append("<tr><th>sysDescr:</th><td><small>" + source.sysDescr + "</small></td></tr>");
            if (source.Status == 'SUCCESS') {
            	$("#tbl tbody").append("<tr><th>pollStatus:</th><td><span class=\"label label-success\">" + source.Status + "</span><small> (last update:"+(new Date(source.pollTime).toISOString())+")</small></td></tr>");
            } 
            if (source.Status == 'TIMEOUT') {
            	$("#tbl tbody").append("<tr><th>pollStatus</th><td><span class=\"label label-danger\">" + source.Status + "</span><small> (last update:"+(new Date(source.pollTime).toISOString())+")</small></td></tr>");
            }
            if (source.Status == 'NO_PDU') {
            	$("#tbl tbody").append("<tr><th>pollStatus</th><td><span class=\"label label-warning\">" + source.Status + "</span><small> (last update:"+(new Date(source.pollTime).toISOString())+")</small></td></tr>");
            }
            if (source.Status == 'NO_IFTABLE') {
            	$("#tbl tbody").append("<tr><th>pollStatus</th><td><span class=\"label label-warning\">" + source.Status + "</span><small> (last update:"+(new Date(source.pollTime).toISOString())+")</small></td></tr>");
            }             
            if (source.Status == 'UNKNOWN') {
            	$("#tbl tbody").append("<tr><th>pollStatus</th><td><span class=\"label label-default\">" + source.Status + "</span></td></tr>");
            }
            //$("#tbl tbody").append("<tr><th>ifNumber</th><td>" + source.ifNumber + "</td></tr>");
            $("#tbl tbody").append("<tr><th>sysUptime</th><td><small>" + uptime(source.sysUptime) + "</small></td></tr>");
         }
    });
       
 	$('#ifTable').DataTable({
       ajax: {
        url: "/api/v1/sources/"+ip+"/interfaces",
        dataSrc: '' 
       },
       columns: [
        { data: "ifIndex" },
       	{ data: "ifDescr" },
       	{ data: "ifName" },
       	{ data: "ifAlias" },
       	{ data: "ifAdminStatus" },
       	{ data: "ifOperStatus" },
       	{ data: "pollInOctets" },
       	{ data: "pollOutOctets" }
       ]
    });

    </script>
  </body>
</html>
